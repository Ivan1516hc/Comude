<app-visitor>
    <main id="mainVisitor" class="main">
        <div class="row">
            <section class="section">
                <div class="container">
                    <h2>Mis solicitudes</h2>
                    <hr>
                    <div class="row">
                        <div class="col-12 col-md-6 col-lg-4 mt-2">
                            <div class="card card-start">
                                <article class="drop-zone" data-bs-toggle="modal" data-bs-target="#exampleModal"
                                    data-bs-whatever="@getbootstrap">
                                    <span>Iniciar solicitud</span>
                                </article>
                            </div>
                        </div>

                        <ng-container *ngIf="requests">
                            <div class="col-12 col-md-6 col-lg-4 mt-2" *ngFor="let item of requests.data">
                                <article class="card">
                                    <img src="assets/img/logo_comude.png" class="card-img-top" alt="Imagen"
                                        style="align-self: center">
                                    <div class="container text-card">
                                        <h1 class="text-center"><strong>Solicitud No.{{item.invoice ??
                                                item.id}}</strong></h1>
                                        <h2 class="text-center" *ngIf="item.finished"><strong>Fecha
                                                {{item.finished}}</strong></h2>
                                        <p *ngIf="item?.discipline"><strong>Diciplina:</strong> {{item.discipline.name}}
                                        </p>
                                        <p *ngIf="item?.competition"><strong>Competencia:</strong>
                                            {{item.competition.name}}</p>
                                        <p *ngIf="item?.competition?.country"><strong>Lugar:</strong>
                                            {{item.competition.state.name ?
                                            item.competition.state.name+',':''}} {{item.competition.country.common_spa}}
                                        </p>
                                        <p *ngIf="item?.competition?.competition_type"><strong>Tipo de
                                                competencia:</strong>
                                            {{item.competition.competition_type.name}}</p>

                                        <p *ngIf="item?.competition?.requested_budget"><strong>Presupuesto
                                                solicitado:</strong> <span
                                                class="badge bg-warning text-dark">${{item.competition.requested_budget}}</span>
                                        </p>

                                        <p *ngIf="item?.competition?.approved_budget"><strong>Presupuesto
                                                aprovado:</strong> <span
                                                class="badge bg-info  text-dark">${{item.competition.approved_budget}}</span>
                                        </p>

                                        <p [ngClass]="item.status_request.id == 1 ? 'alert-secondary':(item.status_request.id == 9 ? 'alert-primary': (item.status_request.id == 2 ? 'alert-warning' : (item.status_request.id == 4 ? 'alert-danger' : '')))"
                                            class="alert text-center mt-2" role="alert">Solicitud
                                            {{item.status_request.name}}
                                        </p>

                                        <div class="d-grid gap-1">
                                            <ng-container
                                                *ngIf="item.status_request_id === 1 || (!item.competition || !hasBankAccount || item.documents_count < 6)">
                                                <button type="button" class="btn-lg btn btn-warning mt-2"
                                                    (click)="continuar(item)">Continuar</button>
                                            </ng-container>


                                            <ng-container
                                                *ngIf="item.status_request_id != 1 && (item.competition && hasBankAccount && item.documents_count >= 6)">
                                                <button type="button" class="btn-lg btn btn-info mt-2"
                                                    [routerLink]="'/solicitante/beca-deportiva/' + item?.id + '/competicion'">Ver</button>
                                            </ng-container>

                                            <ng-container *ngIf="item.status_request_id == 7">
                                                <button type="button" class="btn-lg btn btn-danger mt-2"
                                                    (click)="updateStatus(item.id,9)">Enviar solicitud</button>
                                            </ng-container>

                                            <ng-container
                                                *ngIf="item.status_request_id != 4 && item.status_request_id !=6">
                                                <button type="button" class="btn-lg btn btn-danger mt-2"
                                                    (click)="updateStatus(item,6)">Cancelar</button>
                                            </ng-container>
                                        </div>
                                    </div>
                                </article>
                            </div>
                        </ng-container>
                    </div>
                </div>
            </section>
        </div>
    </main>
</app-visitor>


<div class="modal fade " id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog  modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Selecciona la disciplina</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body py-0 text-justify-custom">
                <!-- <h5 class="mt-2"><strong>Centros</strong></h5> -->
                <div class="m-5">
                    <label class="form-label">Disciplina:</label>
                    <select class="form-select" [(ngModel)]="discipline">
                        <option value="">-Seleccionar-</option>
                        <option *ngFor="let item of catalog?.disciplines" [value]="item?.id">{{item?.name}}
                        </option>
                    </select>
                </div>

                <!-- <div>
                    <label class="form-label">Tipo de competici√≥n:</label>
                    <select class="form-select" [(ngModel)]="competition" (change)="getStates()">
                        <option value="">-Seleccionar-</option>
                        <option *ngFor="let item of catalog.competitions" [value]="item?.id">{{item?.name}}
                        </option>
                    </select>
                </div> -->

            </div>
            <div class="modal-footer flex-column border-top-0">
                <button type="button" class="btn btn-lg btn-primary w-100 mx-0 mb-2" data-bs-dismiss="modal"
                    (click)="storeRequest()">Iniciar
                    solicitud</button>
                <button type="button" class="btn btn-lg btn-light w-100 mx-0" data-bs-dismiss="modal">Cerrar</button>
            </div>
        </div>
    </div>
</div>